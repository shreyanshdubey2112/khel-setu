<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Assessment | Khel-Setu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f9fafb;
            --card-bg-color: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #d1d5db;
            --primary-color: #f97316;
            --primary-btn-hover-bg: #ea580c;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --toggle-bg: #e5e7eb;
            --toggle-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='black'%3E%3Cpath d='M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.894 17.894a.75.75 0 011.06 0l1.591 1.591a.75.75 0 11-1.06 1.06l-1.591-1.59a.75.75 0 010-1.06zM12 18a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM5.106 17.894a.75.75 0 010-1.06l1.591 1.591a.75.75 0 111.06 1.06l-1.59 1.591a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 5.106a.75.75 0 011.06 0l1.591 1.591a.75.75 0 01-1.06 1.06L6.106 6.167a.75.75 0 010-1.06z'/%3E%3C/svg%3E");
        }
        [data-theme="dark"] {
            --bg-color: #111827;
            --card-bg-color: #1f2937;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #4b5563;
            --primary-btn-hover-bg: #fb923c;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --toggle-bg: #4b5563;
            --toggle-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath fill-rule='evenodd' d='M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-3.362 1.578-6.427 4.062-8.472a.75.75 0 01.819.162z' clip-rule='evenodd'/%3E%3C/svg%3E");
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; }
        .container { padding: 1rem; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .main-content-card { 
            width: 100%; 
            max-width: 420px; 
            height: 90vh;
            max-height: 800px;
            background-color: var(--card-bg-color); 
            border-radius: 1rem; 
            box-shadow: 0 4px 6px -1px var(--shadow-color), 0 2px 4px -2px var(--shadow-color); 
            padding: 1.5rem; 
            border: 1px solid var(--border-color); 
            display: flex; 
            flex-direction: column;
        }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;}
        .header-title h1 { font-size: 1.75rem; font-weight: 700; }
        .theme-toggle-button { background-color: var(--toggle-bg); border: none; width: 2.5rem; height: 2.5rem; border-radius: 9999px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .theme-toggle-button::after { content: ''; display: block; width: 1.5rem; height: 1.5rem; background-image: var(--toggle-icon); background-size: cover; }

        .assessment-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-height: 0;
        }

        .camera-view {
            flex: 1;
            background-color: #000;
            border-radius: 0.75rem;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .camera-view video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        .camera-message {
            color: white;
            padding: 1rem;
            text-align: center;
            position: absolute;
        }

        .ai-instructions {
            flex-shrink: 0;
            background-color: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.75rem;
        }
        .ai-instructions h2 {
            font-size: 1.25rem;
            color: var(--text-primary);
            margin-bottom: 0;
        }
        .ai-instructions p {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .start-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.3s;
            margin-top: 0.5rem;
            text-decoration: none;
        }
        .start-btn:hover { background-color: var(--primary-btn-hover-bg); }
        .start-btn.hidden {
            opacity: 0;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content-card">
            <header class="page-header">
                <div class="header-title">
                    <h1>Assessment</h1>
                </div>
                <button id="theme-toggle" class="theme-toggle-button" aria-label="Toggle theme"></button>
            </header>

            <div class="assessment-content">
                <div class="camera-view">
                    <video id="camera-feed" autoplay playsinline></video>
                    <div id="camera-message" class="camera-message">
                        <p>Requesting camera access...</p>
                    </div>
                </div>
                <div class="ai-instructions">
                    <h2>AI Coach</h2>
                    <p id="ai-text">Ensure you have good lighting and enough space to move. <br>Tap start when you're ready.</p>
                    <button id="start-assessment-btn" class="start-btn">Start Assessment</button>
                    <a href="./home.html" id="home-btn" class="start-btn hidden">Return to Home</a>
                </div>
            </div>
            
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggleButton = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            const videoElement = document.getElementById('camera-feed');
            const messageElement = document.getElementById('camera-message');
            const startButton = document.getElementById('start-assessment-btn');
            const aiText = document.getElementById('ai-text');
            const homeButton = document.getElementById('home-btn');

            const setTheme = (theme) => {
                htmlElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            };

            themeToggleButton.addEventListener('click', () => {
                const currentTheme = htmlElement.getAttribute('data-theme');
                setTheme(currentTheme === 'light' ? 'dark' : 'light');
            });
            
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            setTheme(savedTheme || (prefersDark ? 'dark' : 'light'));

            async function startCamera() {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                        videoElement.srcObject = stream;
                        messageElement.style.display = 'none';
                    } catch (error) {
                        console.error("Error accessing camera: ", error);
                        messageElement.innerHTML = `<p>Camera access denied. Please allow camera access in your browser settings.</p>`;
                    }
                } else {
                     messageElement.innerHTML = `<p>Your browser does not support camera access.</p>`;
                }
            }
            startCamera();

            startButton.addEventListener('click', () => {
                startButton.classList.add('hidden');
                
                const instructions = [
                    "Get ready! Starting in 3...",
                    "Starting in 2...",
                    "Starting in 1...",
                    "Let's begin. Please perform 10 squats.",
                    "Keep your form steady. Back straight.",
                    "Great work! Now, 15 jumping jacks.",
                    "Keep up the pace!",
                    "Final exercise: Hold a plank for 20 seconds.",
                    "Almost there... 5, 4, 3, 2, 1.",
                    "Assessment Complete! Amazing effort."
                ];

                let instructionIndex = 0;
                
                const showNextInstruction = () => {
                    if (instructionIndex < instructions.length) {
                        aiText.textContent = instructions[instructionIndex];
                        instructionIndex++;
                    } else {
                        clearInterval(instructionInterval);
                        aiText.textContent = "You can review your results on the profile page.";
                        homeButton.classList.remove('hidden');
                    }
                };

                showNextInstruction();
                const instructionInterval = setInterval(showNextInstruction,1000);
            });
        });
    </script>
</body>
</html>

